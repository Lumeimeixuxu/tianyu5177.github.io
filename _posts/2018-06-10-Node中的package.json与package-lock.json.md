---
layout: post
title: "Node中的package.json与package-lock.json"
date: 2018-06-10
description: "MongoDB，前端技术"
tag: Node.js
--- 

### **1. package.json的作用**
**1.1 在npm 5.0.x版本之前：**

> 1. package.json文件在执行```npm init```时生成。
> 2. pacakge.json中间标出项目对npm各种包的依赖。
> 3. 在安装包时追加```--save```指令，将依赖添加进package.json中
> 4. 添加依赖的优势是：当项目迁移，或者合作开发时，其他人下载依赖包时node会根据package.json中记录的版本进行下载。

&emsp;举例说明（演示本例时的npm版本为3.10.10）：

> 1. 新建demo文件夹，```npm init```初始化package.json文件.
> 2. 安装ejs包：```npm install ejs --save```，此时demo文件夹中包含：node_modules文件夹、package.json文件。

&emsp;我们打开package.json查看内容如下：

	{
	  "name": "demo",
	  "version": "1.0.0",
	  "description": "",
	  "main": "index.js",
	  "scripts": {
	    "test": "echo \"Error: no test specified\" && exit 1"
	  },
	  "author": "",
	  "license": "ISC",
	  "dependencies": {
	    "ejs": "^2.6.1"
	  }
	}

&emsp;&emsp;注意ejs显示的版本为：```^2.6.1``` ，我们来探讨依一下这个：

> 1. ```2.6.1``` 代表当前安装的版本。
> 2. ```^``` 代表向后（新）兼容依赖，关于兼容依赖**要注意的是：**将版本手动改为^2.5.1，删除node_modules文件夹，再次安装，因为有```^```的存在，并且最新的ejs版本为2.6.1所以安装的版本还是2.6.1
> 3. 但是，当将版本手动改为```^1.0.0```时，删除node_modules文件夹，再次安装，安装的依然是```1.0.0```，因为npm默认是不会垮大版本去升级的。
> 4. **总结：**```^```代表的的向后（新）兼容依赖，是指在大版本一样的前提下，上文中第二次改为1.0.0，大版本发生变化，所以即便是向后兼容了，npm也不会跨大版本升级，如果手动去掉```^```则npm会严格按照package.json记录值下载包。npm这种机制，一方面是为了保证在日后安装包时能够下载较新的版本，另一方面也是为了保证之前的代码不受包的版本所影响，即：“更新的同时尽量缩小影响”。
> 4. **关于版本号：**一般情况下，在版本号```Va.b.c```格式中，例如：V1.0.0，我们“约定俗成”：更新c位，一般是修复bug的版本；更新b位，一般是小功能更新，不会改变语法、接口调用方式等核心内容；更新a位，一般是大幅度的更新，甚至是改变语法、更新重要接口等。

**1.2 在npm 5.0.x版本之后：**

> 1. 与5.0.x之前版本相比，基本一致，不过不再需要```--save```添加依赖，会自动添加。
> 2. 同时增加了```package-lock.json```文件,下文详细说明。

<br>

### **2. package-lock.json的作用**

&emsp;&emsp;npm经过一段时间的壮大，包越来越多，npm的大仓库可以说越来越丰富，各个包的版本迭代也越来越多，但问题也出现了，有些开发人员不按照我们之前“约定俗成”的版本规则迭代版本，导致了有些包2.3.1版本和2.3.2版本差别巨大，甚至语法格式、方法调用方式等等都发生了改变，所以package-lock.json应运而生。

**2.1 用一句话来概括package-lock.json的作用：**

> package-lock.json就是锁定安装时各个包的详细版本号，并且保存当前包的下载地址，这个文件我们需要上传到git，以保证其他人在任何时候执行npm install时都能与package-lock.json中规定的版本一直，可以说是严格的“锁”住了包的版本，甚至是下载来源。

### **3. 我们要怎样操作**

> 1. 首先明确的是，package-lock.json只是一个辅助，是一把锁。
> 2. npm还是先读取package.json，如果package-lock.json内容锁定的版本与package.json中的一致，则直接从lock中读取下载地址，直接下载；如果不一致，以package.json为准下载，随后更新lock文件。
> 3. 正式因为有了这两个文件的存在，为了不引起奇葩的问题，我们最好不要去手动修改这两个文件，有时候直接手动更改也是无效的，如果发现某个版本的包有问题，想安装指定版本，可以用```npm i xxx@a.b.c```命令，例如安装2.5.1版本的ejs：```npm i ejs@2.5.1```。
> 4. lock文件是我们要提交到版本管理中的，这样就会严格的保证项目组成员的版本都一致，如果发现lock文件和package文件有更新，则直接更新，随后执行```npm install```，npm会自动更新为指定版本。


